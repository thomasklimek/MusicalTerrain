<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Babylon Template</title>

    <style>
    html, body {
        overflow: hidden;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
    }

    #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
    }
</style>

<script src="https://preview.babylonjs.com/babylon.js"></script>
<script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
<script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
<script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
</head>

<body>

    <canvas id="renderCanvas" touch-action="none"></canvas> //touch-action="none" for best results from PEP

    <script>
        var canvas = document.getElementById("renderCanvas"); // Get the canvas element 
        var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine

        /******* Add the create scene function ******/
        var createScene = function () {
        // Create the scene space
        var scene = new BABYLON.Scene(engine);

        // Add a camera to the scene and attach it to the canvas
        //var camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2 , Math.PI / 2 + 1, 500, BABYLON.Vector3.Zero(), scene);
        
        //////////////START MY WORK/////////////////////////////
        var colcamera = new BABYLON.FreeCamera("walkC", new BABYLON.Vector3(0,50,0), scene);
        colcamera.attachControl(canvas, true);

        var perchCamera = new BABYLON.ArcRotateCamera("perchC", -Math.PI / 2 , Math.PI / 2 + 1, 500, BABYLON.Vector3.Zero(), scene);

        var noClipCamera =  new BABYLON.FreeCamera("no-clipC", new BABYLON.Vector3(0,50,0), scene);

        colcamera.attachControl(canvas, true);
        perchCamera.attachControl(canvas, true);
        noClipCamera.attachControl(canvas,true);

        var camerasBorderFunction = function () {
            //keep perchCamera from going to too low an angle, or too close
            //to the image
            if (perchCamera.beta < 0.1)
                perchCamera.beta = 0.1;
            else if (perchCamera.beta > (Math.PI / 2) * 0.9)
                perchCamera.beta = (Math.PI / 2) * 0.9;

            if (perchCamera.radius > 500)
                perchCamera.radius = 500;

            if (perchCamera.radius < 30)
                perchCamera.radius = 30;

            //keep the no-clip camera from moving too far
            if (noClipCamera.position.y < 0) noClipCamera.position.y = 0;
            if (noClipCamera.position.y > 600) noClipCamera.position.y = 600;

            if (noClipCamera.position.x < -500) noClipCamera.position.x = -500;
            if (noClipCamera.position.x > 500) noClipCamera.position.x = 500;

            if (noClipCamera.position.z < -500) noClipCamera.position.z = -500;
            if (noClipCamera.position.z > 500) noClipCamera.position.z = 500;

            //prevent the walkCamera from walking off the plane
            if (colcamera.position.x < -240) colcamera.position.x = -240;
            if (colcamera.position.x > 240) colcamera.position.x = 240;

            if (colcamera.position.z < -240) colcamera.position.z = -240;
            if (colcamera.position.z > 240) colcamera.position.z = 240;

        };

        scene.registerBeforeRender(camerasBorderFunction);
        //////////END MY WORK/////////////////////////////////



        // Add lights to the scene
        var light1 = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(1, 1, 0), scene);
        //var light2 = new BABYLON.PointLight("light2", new BABYLON.Vector3(0, 1, -1), scene);

        // Add and manipulate meshes in the scene
        //var plane = BABYLON.MeshBuilder.CreatePlane("plane", {height:500, width: 500}, scene);
        var ground = BABYLON.Mesh.CreateGroundFromHeightMap("ground", "test.jpg", 500, 500, 250, 0, 20, scene, false);


        var groundMaterial = new BABYLON.StandardMaterial("ground", scene);
        groundMaterial.diffuseTexture = new BABYLON.Texture("goosebumps.jpg", scene);

        ground.material = groundMaterial;

        ///////////////START MY WORK/////////////////////////////////////
        //Plays Song
        var song = new BABYLON.Sound("Song", "goosebumps.wav", scene, null, {loop: true, autoplay: true});    

        //Moveable Camera with Collision
        scene.gravity = new BABYLON.Vector3(0, -9.81, 0);
        colcamera.applyGravity = true;
        colcamera.ellipsoid = new BABYLON.Vector3(0.5,1,0.5);
        scene.collisionsEnabled = true;
        colcamera.checkCollisions = true;
        noClipCamera.collisionsEnabled = true;
        ground.checkCollisions = true;

        //UI
        var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI", scene);
        var perchCamButton = new BABYLON.GUI.Button.CreateSimpleButton("fly", "Perch Camera")
        perchCamButton.width = 0.2;
        perchCamButton.height = "40px";
        perchCamButton.color = "white";
        perchCamButton.background = "green";
        perchCamButton.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
        perchCamButton.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
        advancedTexture.addControl(perchCamButton);
        perchCamButton.onPointerClickObservable.add(function () {
            scene.activeCamera = perchCamera;
        })

        var noClipCamButton = new BABYLON.GUI.Button.CreateSimpleButton("no-clip", "No-Clip Camera")
        noClipCamButton.width = 0.2;
        noClipCamButton.height = "40px";
        noClipCamButton.color = "white";
        noClipCamButton.background = "green";
        noClipCamButton.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
        noClipCamButton.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
        advancedTexture.addControl(noClipCamButton);
        noClipCamButton.onPointerClickObservable.add(function () {
            scene.activeCamera = noClipCamera;
        })

        var walkCamButton = new BABYLON.GUI.Button.CreateSimpleButton("walk", "Walk Camera")
        walkCamButton.width = 0.2;
        walkCamButton.height = "40px";
        walkCamButton.color = "white";
        walkCamButton.background = "green";
        walkCamButton.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
        walkCamButton.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
        advancedTexture.addControl(walkCamButton);
        walkCamButton.onPointerClickObservable.add(function () {
            scene.activeCamera = colcamera;
        })

        var pausePlayButton = new BABYLON.GUI.Button.CreateSimpleButton("pauseplay", "Pause/Play")
        pausePlayButton.width = 0.2;
        pausePlayButton.height = "40px";
        pausePlayButton.color = "white";
        pausePlayButton.background = "green";
        pausePlayButton.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
        pausePlayButton.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
        advancedTexture.addControl(pausePlayButton);
        pausePlayButton.onPointerClickObservable.add(function () {
            if(song.isPlaying()){
                song.pause(); 
            }else{ song.play();}
        })
        ///////////////END MY WORK////////////////////////////////////

        return scene;
    }
    /******* End of the create scene function ******/    

        var scene = createScene(); //Call the createScene function

        // Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () { 
            scene.render();
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () { 
            engine.resize();
        });
    </script>

</body>

</html>